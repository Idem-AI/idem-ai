@if(isGenerating()) {
<!-- Sticky Progress Header -->
<div class="fixed top-16 left-0 right-0 z-50 bg-gray-900/95 backdrop-blur-md border-b border-gray-700/50">
  <div class="max-w-7xl mx-auto px-6 py-4">
    <div class="flex items-center justify-between">
      <!-- Left: Status Info -->
      <div class="flex items-center space-x-4">
        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
          <i class="pi pi-cog animate-spin text-xl text-white"></i>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-white">Génération en cours</h3>
          <p class="text-sm text-gray-400">{{ completedSteps().length }}/6 étapes terminées</p>
        </div>
      </div>
      
      <!-- Right: Progress Bar and Percentage -->
      <div class="flex items-center space-x-4 min-w-0 flex-1 max-w-md ml-8">
        <div class="flex-1">
          <p-progressBar
            [value]="progressPercentage()"
            [showValue]="false"
            styleClass="custom-progress-bar"
          ></p-progressBar>
        </div>
        <div class="text-right">
          <span class="text-2xl font-bold text-white">{{ progressPercentage() }}%</span>
          <p class="text-xs text-gray-400">Terminé</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main Content with Top Padding -->
<div class="pt-32 min-h-screen">
  <div class="max-w-7xl mx-auto px-6 space-y-8">

  @if(hasCompletedSteps()) {
  <div class="completed-steps-section glass-card">
    <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
      <i class="pi pi-check-circle text-green-500 mr-3"></i>
      Completed Steps
    </h3>
    <div class="grid gap-4">
      @for (step of completedSteps(); track step.stepName) {
      <p-card class="step-completed-card">
        <ng-template pTemplate="header">
          <div class="flex items-center justify-between p-4">
            <div class="flex items-center">
              <i class="pi pi-check text-green-600 text-xl mr-3"></i>
              <div>
                <h4 class="font-semibold text-green-800">
                  {{ step.stepName }}
                </h4>
                <p class="text-sm text-green-600">{{ step.summary }}</p>
              </div>
            </div>
            <p-tag
              [value]="(step.timestamp | date:'HH:mm:ss') || 'N/A'"
              severity="success"
              icon="pi pi-clock"
            ></p-tag>
          </div>
        </ng-template>

        @if(step.content && step.content !== 'step_started') {
        <div class="step-content">
          <markdown
            mermaid
            [data]="step.content"
            class="prose max-w-none"
          ></markdown>
        </div>
        }
      </p-card>
      }
    </div>
  </div>
  } @if(currentStep()) {
  <div class="current-step-section glass-card p-4">
    <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
      <i class="pi pi-spin pi-cog text-blue-500 mr-3"></i>
      Generation in Progress...
    </h3>

    <div>
      <div>
        <div class="flex items-center justify-between p-4">
          <div class="flex items-center">
            <i class="pi pi-spin pi-spinner text-primary text-xl mr-3"></i>
            <div>
              <h4 class="font-semibold text-blue-800">
                {{ currentStep()!.stepName }}
              </h4>
              <p class="text-sm text-primary">{{ currentStep()!.summary }}</p>
            </div>
          </div>
          <p-tag value="En cours" severity="info" icon="pi pi-clock"></p-tag>
        </div>
      </div>

      <!-- Skeleton Loaders for Content Being Generated -->
      <div class="p-4 space-y-4 glass-card bg-gray-800">
        <p-skeleton height="2rem" class="mb-3 bg-gray-800"></p-skeleton>
        <p-skeleton height="4rem" class="mb-3 bg-gray-800"></p-skeleton>
        <div class="grid grid-cols-2 gap-4">
          <p-skeleton height="3rem" class="bg-gray-800"></p-skeleton>
          <p-skeleton height="3rem" class="bg-gray-800"></p-skeleton>
        </div>
        <p-skeleton height="2rem" width="70%" class="bg-gray-800"></p-skeleton>
      </div>
    </div>
  </div>
  }

  <!-- Cancel Button -->
  <div class="text-center mt-8">
    <p-button
      label="Annuler la Génération"
      icon="pi pi-times"
      severity="danger"
      (onClick)="cancelGeneration()"
      styleClass="cancel-button"
    ></p-button>
  </div>
</div>
} @else if(generationError()) {
<!-- Error State -->
<div class="max-w-6xl mx-auto">
  <div class="text-center py-20">
    <div class="mb-4">
      <svg
        class="mx-auto h-16 w-16 text-red-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"
        ></path>
      </svg>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">Generation Failed</h3>
    <p class="text-gray-600 mb-6">{{ generationError() }}</p>
    <button
      class="inner-button text-white px-6 py-2 rounded-md transition-colors"
      (click)="generateDiagrams()"
    >
      Try Again
    </button>
  </div>
</div>
} @else {
<!-- Initial State -->
<div
  #scrollContainer
  class="max-w-7xl mx-auto space-y-6   fixed"
>
  <div
    class="generation-header-card glass-card grid grid-cols-2 fixed top-[56px] z-10"
  >
    <div class="flex items-center">
      <div
        class="w-20 h-20 glass-card rounded-full flex items-center justify-center border-opacity-30"
      >
        <i class="pi pi-cog animate-spin text-4xl text-white"></i>
      </div>
      <h2 class="text-2xl font-bold text-white">
        Diagrams Generation in Progress...
      </h2>
    </div>
    <div class="flex items-center justify-end">
      <p class="text-gray-400">
        {{ progressPercentage() }}% Finished ({{ completedSteps().length }}/6
        steps)
      </p>
      <p-progressBar
        [value]="progressPercentage()"
        [showValue]="false"
        class="ml-3 custom-progress-bar"
      ></p-progressBar>
    </div>
  </div>

  @if(hasCompletedSteps()) {
  <div class="completed-steps-section glass-card">
    <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
      <i class="pi pi-check-circle text-green-500 mr-3"></i>
      Completed Steps
    </h3>
    <div class="grid gap-4">
      @for (step of completedSteps(); track step.stepName) {
      <p-card class="step-completed-card">
        <ng-template pTemplate="header">
          <div class="flex items-center justify-between p-4">
            <div class="flex items-center">
              <i class="pi pi-check text-green-600 text-xl mr-3"></i>
              <div>
                <h4 class="font-semibold text-green-800">
                  {{ step.stepName }}
                </h4>
                <p class="text-sm text-green-600">{{ step.summary }}</p>
              </div>
            </div>
            <p-tag
              [value]="(step.timestamp | date:'HH:mm:ss') || 'N/A'"
              severity="success"
              icon="pi pi-clock"
            ></p-tag>
          </div>
        </ng-template>

        @if(step.content && step.content !== 'step_started') {
        <div class="step-content">
          <markdown
            mermaid
            [data]="step.content"
            class="prose max-w-none"
          ></markdown>
        </div>
        }
      </p-card>
      }
    </div>
  </div>
  } @if(currentStep()) {
  <div class="current-step-section glass-card p-4">
    <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
      <i class="pi pi-spin pi-cog text-blue-500 mr-3"></i>
      Generation in Progress...
    </h3>

    <div>
      <div>
        <div class="flex items-center justify-between p-4">
          <div class="flex items-center">
            <i class="pi pi-spin pi-spinner text-primary text-xl mr-3"></i>
            <div>
              <h4 class="font-semibold text-blue-800">
                {{ currentStep()!.stepName }}
              </h4>
              <p class="text-sm text-primary">{{ currentStep()!.summary }}</p>
            </div>
          </div>
          <p-tag value="En cours" severity="info" icon="pi pi-clock"></p-tag>
        </div>
      </div>

      <!-- Skeleton Loaders for Content Being Generated -->
      <div class="p-4 space-y-4 glass-card bg-gray-800">
        <p-skeleton height="2rem" class="mb-3 bg-gray-800"></p-skeleton>
        <p-skeleton height="4rem" class="mb-3 bg-gray-800"></p-skeleton>
        <div class="grid grid-cols-2 gap-4">
          <p-skeleton height="3rem" class="bg-gray-800"></p-skeleton>
          <p-skeleton height="3rem" class="bg-gray-800"></p-skeleton>
        </div>
        <p-skeleton height="2rem" width="70%" class="bg-gray-800"></p-skeleton>
      </div>
    </div>
  </div>
  }

  <!-- Cancel Button -->
  <div class="text-center mt-8">
    <p-button
      label="Annuler la Génération"
      icon="pi pi-times"
      severity="danger"
      (onClick)="cancelGeneration()"
      styleClass="cancel-button"
    ></p-button>
  </div>
</div>
<div class="max-w-6xl mx-auto">
  <div class="text-center py-20">
    <div class="mb-4">
      <svg
        class="mx-auto h-16 w-16 text-gray-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
        ></path>
      </svg>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">
      Ready to Generate Diagrams
    </h3>
    <p class="text-gray-600 mb-6">
      Click the button below to start generating your system design diagrams.
    </p>
    <button
      class="inner-button text-white px-6 py-2 rounded-md transition-colors"
      (click)="generateDiagrams()"
    >
      Generate Diagrams
    </button>
  </div>
</div>
}
