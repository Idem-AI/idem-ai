@if(isGenerating()) {
<div
  #scrollContainer
  class="max-w-7xl mx-auto space-y-6 max-h-screen overflow-y-auto"
>
  <p-card class="generation-header-card bg-gray-900">
    <div class="text-center py-8">
      <div class="mb-6">
        <div class="generation-icon-container">
          <i class="pi pi-cog animate-spin text-4xl text-white"></i>
        </div>
        <h2
          class="text-3xl font-bold bg-primary bg-clip-text text-transparent mb-2"
        >
          Génération de Diagrammes en Cours
        </h2>
        <p class="text-gray-600 text-lg">
          {{ progressPercentage() }}% Terminé ({{ completedSteps().length }}/6
          étapes)
        </p>
      </div>

      <div class="px-8">
        <p-progressBar
          [value]="progressPercentage()"
          [showValue]="false"
          styleClass="custom-progress-bar"
        ></p-progressBar>
      </div>
    </div>
  </p-card>

  @if(hasCompletedSteps()) {
  <div class="completed-steps-section">
    <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
      <i class="pi pi-check-circle text-green-500 mr-3"></i>
      Étapes Terminées
    </h3>
    <div class="grid gap-4">
      @for (step of completedSteps(); track step.stepName) {
      <p-card class="step-completed-card">
        <ng-template pTemplate="header">
          <div class="flex items-center justify-between p-4">
            <div class="flex items-center">
              <i class="pi pi-check text-green-600 text-xl mr-3"></i>
              <div>
                <h4 class="font-semibold text-green-800">
                  {{ step.stepName }}
                </h4>
                <p class="text-sm text-green-600">{{ step.summary }}</p>
              </div>
            </div>
            <p-tag
              [value]="(step.timestamp | date:'HH:mm:ss') || 'N/A'"
              severity="success"
              icon="pi pi-clock"
            ></p-tag>
          </div>
        </ng-template>

        @if(step.content && step.content !== 'step_started') {
        <div class="step-content">
          <markdown
            mermaid
            [data]="step.content"
            class="prose max-w-none"
          ></markdown>
        </div>
        }
      </p-card>
      }
    </div>
  </div>
  }

  @if(currentStep()) {
  <div class="current-step-section">
    <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
      <i class="pi pi-spin pi-cog text-blue-500 mr-3"></i>
      Génération en Cours...
    </h3>

    <p-card class="step-current-card">
      <ng-template pTemplate="header">
        <div class="flex items-center justify-between p-4">
          <div class="flex items-center">
            <i class="pi pi-spin pi-spinner text-primary text-xl mr-3"></i>
            <div>
              <h4 class="font-semibold text-blue-800">
                {{ currentStep()!.stepName }}
              </h4>
              <p class="text-sm text-primary">{{ currentStep()!.summary }}</p>
            </div>
          </div>
          <p-tag value="En cours" severity="info" icon="pi pi-clock"></p-tag>
        </div>
      </ng-template>

      <!-- Skeleton Loaders for Content Being Generated -->
      <div class="p-4 space-y-4">
        <p-skeleton height="2rem" class="mb-3"></p-skeleton>
        <p-skeleton height="4rem" class="mb-3"></p-skeleton>
        <div class="grid grid-cols-2 gap-4">
          <p-skeleton height="3rem"></p-skeleton>
          <p-skeleton height="3rem"></p-skeleton>
        </div>
        <p-skeleton height="2rem" width="70%"></p-skeleton>
      </div>
    </p-card>
  </div>
  }

  <!-- Cancel Button -->
  <div class="text-center mt-8">
    <p-button
      label="Annuler la Génération"
      icon="pi pi-times"
      severity="danger"
      (onClick)="cancelGeneration()"
      styleClass="cancel-button"
    ></p-button>
  </div>
</div>
} 
 @else if(generationError()) {
<!-- Error State -->
<div class="max-w-6xl mx-auto">
  <div class="text-center py-20">
    <div class="mb-4">
      <svg
        class="mx-auto h-16 w-16 text-red-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"
        ></path>
      </svg>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">Generation Failed</h3>
    <p class="text-gray-600 mb-6">{{ generationError() }}</p>
    <button
      class="bg-primary hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-colors"
      (click)="generateDiagrams()"
    >
      Try Again
    </button>
  </div>
</div>
} @else {
  <!-- Initial State -->
<div class="max-w-6xl mx-auto">
  <div class="text-center py-20">
    <div class="mb-4">
      <svg
        class="mx-auto h-16 w-16 text-gray-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
        ></path>
      </svg>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">
      Ready to Generate Diagrams
    </h3>
    <p class="text-gray-600 mb-6">
      Click the button below to start generating your system design diagrams.
    </p>
    <button
      class="inner-button text-white px-6 py-2 rounded-md transition-colors"
      (click)="generateDiagrams()"
    >
      Generate Diagrams
    </button>
  </div>
</div>
}
