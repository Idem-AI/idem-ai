<div>
  <div class="flex justify-between items-center mb-8">
    <h2 class="text-2xl font-semibold border-l-4 border-l-teal-500 pl-4">
      Architecture Templates
    </h2>
    <button
      class="px-3 py-2 rounded-lg hover:bg-gray-800 text-gray-300 transition-all flex items-center gap-2"
      (click)="resetView()"
    >
      <i class="pi pi-arrow-left"></i> Back
    </button>
  </div>

  <!-- Step 1: Template Gallery -->
  @if (!selectedTemplate()) {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      @for (template of availableTemplates(); track template.id) {
        <div
          class="bg-gray-900/50 rounded-xl border border-gray-800 p-6 flex flex-col hover:border-teal-500/50 hover:-translate-y-1 transition-all cursor-pointer animate-fade-in"
          (click)="selectTemplate(template)"
        >
          <div class="flex items-center gap-4 mb-4">
            <i class="{{template.icon}} text-2xl text-teal-400"></i>
            <h3 class="text-lg font-semibold text-gray-100">{{ template.name }}</h3>
          </div>
          <p class="text-gray-400 text-sm flex-grow">{{ template.description }}</p>
          <div class="mt-4 flex flex-wrap gap-2">
            @for (tag of template.tags; track tag) {
              <span class="text-xs font-medium bg-teal-500/20 text-teal-300 px-2 py-1 rounded-full">
                {{ tag }}
              </span>
            }
          </div>
        </div>
      }
    </div>
  }

  <!-- Step 2: Template Configuration Form -->
  @else {
    <div class="bg-gray-900/50 rounded-xl border border-gray-800 p-8 shadow-xl max-w-3xl mx-auto animate-fade-in">
      <h3 class="text-xl font-semibold mb-2 flex items-center gap-3">
        <i class="{{selectedTemplate()?.icon}} text-teal-400"></i>
        Configuration for: {{ selectedTemplate()?.name }}
      </h3>
      <p class="text-gray-400 mb-6">{{ selectedTemplate()?.description }}</p>

      <form [formGroup]="deploymentForm()" class="space-y-6">
        <div>
          <label for="name" class="block text-sm font-medium text-gray-300 mb-2">
            Deployment Name
          </label>
          <input
            id="name"
            type="text"
            formControlName="name"
            placeholder="My Template Deployment"
            class="w-full bg-gray-800/80 border border-gray-700 focus:border-teal-500 text-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-teal-500/30 focus:outline-none transition-all placeholder-gray-400"
          />
        </div>

        <div>
          <label for="environment" class="block text-sm font-medium text-gray-300 mb-2">
            Environment
          </label>
          <select
            id="environment"
            formControlName="environment"
            class="w-full bg-gray-800/80 border border-gray-700 focus:border-teal-500 text-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-teal-500/30 focus:outline-none transition-all"
          >
            <option value="development">Development</option>
            <option value="staging">Staging</option>
            <option value="production">Production</option>
          </select>
        </div>

        <div>
          <label for="repoUrl" class="block text-sm font-medium text-gray-300 mb-2">
            Git Repository URL
          </label>
          <input
            id="repoUrl"
            type="url"
            formControlName="repoUrl"
            placeholder="https://github.com/user/repo.git"
            class="w-full bg-gray-800/80 border border-gray-700 focus:border-teal-500 text-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-teal-500/30 focus:outline-none transition-all placeholder-gray-400"
          />
        </div>

        <div>
          <label for="branch" class="block text-sm font-medium text-gray-300 mb-2">
            Branch
          </label>
          <input
            id="branch"
            type="text"
            formControlName="branch"
            placeholder="main"
            class="w-full bg-gray-800/80 border border-gray-700 focus:border-teal-500 text-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-teal-500/30 focus:outline-none transition-all placeholder-gray-400"
          />
        </div>

        <div class="flex justify-end gap-4 pt-4 border-t border-gray-700/50">
          <button
            type="button"
            (click)="backToTemplates()"
            class="px-6 py-2 rounded-lg border border-gray-600 hover:bg-gray-700/50 text-gray-300 transition-colors"
          >
            Change Template
          </button>
          <button
            type="button"
            (click)="createDeployment()"
            class="px-6 py-2 bg-gradient-to-r from-teal-600 to-green-600 hover:from-teal-700 hover:to-green-700 rounded-lg text-white font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
            [disabled]="!isFormValid()"
          >
            <i class="pi pi-rocket"></i>
            Deploy Template
          </button>
        </div>
      </form>
    </div>
  }
</div>
