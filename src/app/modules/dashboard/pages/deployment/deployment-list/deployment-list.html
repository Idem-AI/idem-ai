<div class="mx-auto  p-4 text-gray-100">
  <div class="mb-8">
    <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">Project Deployments</h1>
    <p class="text-sm opacity-80 mt-1">View and manage your project deployments</p>

    <div class="mt-4 flex justify-end">
      <button
        class="inline-flex items-center gap-2 rounded-md border border-white/10 bg-white/5 px-3 py-2 text-sm hover:bg-white/10 transition"
        [routerLink]="['/console/deployments/create']"
      >
        <i class="pi pi-plus"></i>
        New Deployment
      </button>
    </div>
  </div>

  <!-- Loading state -->
  @if (loading()) {
  <div class="flex flex-col items-center justify-center text-center rounded-xl  p-8 min-h-[220px] mb-6">
    <app-loader />
    <p class="mt-3">Loading deployments...</p>
  </div>
  }

  <!-- Error state -->
  @if (error()) {
  <div class="flex flex-col items-center justify-center text-center rounded-xl  p-8 min-h-[220px] mb-6">
    <div class="text-4xl text-red-400 mb-3">
      <i class="pi pi-exclamation-triangle"></i>
    </div>
    <p class="mb-4">{{ error() }}</p>
    @if (projectId()) {
    <button class="inline-flex items-center gap-2 rounded-md border border-white/10 bg-white/5 px-3 py-2 text-sm hover:bg-white/10 transition" (click)="fetchDeployments(projectId()!)">
      Try Again
    </button>
    }
  </div>
  }

  <!-- Empty state -->
  @if (!loading() && !error() && deployments().length === 0) {
  <div class="flex flex-col items-center justify-center text-center rounded-xl  p-10 min-h-[260px] mb-6">
    <div class="text-5xl bg-gradient-to-tr from-primary to-secondary bg-clip-text text-transparent mb-4">
      <i class="pi pi-rocket"></i>
    </div>
    <h2 class="text-xl font-semibold mb-2">No Deployments Found</h2>
    <p class="opacity-75 max-w-md mb-6">You haven't deployed this project yet. Create your first deployment to get started.</p>
    <button
      class="inline-flex items-center gap-2 rounded-md border border-white/10 bg-white/5 px-4 py-2 text-sm hover:bg-white/10 transition"
      [routerLink]="['/console/deployments/create']"
    >
      Create Deployment
    </button>
  </div>
  }

  <!-- Deployments table -->
  @if (!loading() && !error() && deployments().length > 0) {
  <div class="relative rounded-xl  shadow-lg overflow-hidden mb-6">
    <div class="absolute inset-0 rounded-xl p-px pointer-events-none" style="background: linear-gradient(135deg,var(--color-primary),var(--color-secondary)); mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; mask-composite: exclude;"></div>
    <div class="overflow-x-auto">
    <table class="w-full text-left">
      <thead>
        <tr>
          <th class="bg-slate-950/60 font-semibold text-gray-100 whitespace-nowrap px-4 py-3">Name</th>
          <th class="bg-slate-950/60 font-semibold text-gray-100 whitespace-nowrap px-4 py-3">Environment</th>
          <th class="bg-slate-950/60 font-semibold text-gray-100 whitespace-nowrap px-4 py-3">Status</th>
          <th class="bg-slate-950/60 font-semibold text-gray-100 whitespace-nowrap px-4 py-3">Version</th>
          <th class="bg-slate-950/60 font-semibold text-gray-100 whitespace-nowrap px-4 py-3">URL</th>
          <th class="bg-slate-950/60 font-semibold text-gray-100 whitespace-nowrap px-4 py-3">Created</th>
          <th class="bg-slate-950/60 font-semibold text-gray-100 whitespace-nowrap px-4 py-3">Last Updated</th>
          <th class="bg-slate-950/60 font-semibold text-gray-100 whitespace-nowrap px-4 py-3">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (deployment of deployments(); track deployment.id) {
        <tr
          (click)="viewDeploymentDetails(deployment.id, $event)"
          class="border-b border-white/5 hover:bg-white/5 transition-colors cursor-pointer">
          <td class="min-w-[180px] px-4 py-3">
            <div class="font-medium">{{ deployment.name }}</div>
            <div class="text-xs opacity-60 mt-1">ID: {{ deployment.id }}</div>
          </td>
          <td>
            <span [ngClass]="getEnvClass(deployment.environment)" class="ml-4">{{ deployment.environment }}</span>
          </td>
          <td>
            <div [ngClass]="getStatusClass(deployment.status)" class="ml-4">
              <span [ngClass]="getStatusIndicatorClass(deployment.status)"></span>
              <span class="text-sm">{{ deployment.status }}</span>
            </div>
          </td>
          <td class="px-4 py-3">{{ deployment.version || 'N/A' }}</td>
          <td>
            @if (deployment.url) {
            <a [href]="deployment.url" target="_blank" class="inline-flex items-center gap-1 text-primary hover:text-secondary hover:underline ml-4">
              {{ truncateUrl(deployment.url) }}
              <i class="pi pi-external-link text-xs"></i>
            </a>
            } @else {
            <span>N/A</span>
            }
          </td>
          <td class="px-4 py-3">{{ formatDate(deployment.createdAt) }}</td>
          <td class="px-4 py-3">{{ formatDate(deployment.updatedAt) }}</td>
          <td class="w-[120px] px-4 py-3">
            <div class="flex gap-2">
              <button
                class="bg-transparent text-gray-200 border border-white/10 rounded w-[30px] h-[30px] grid place-items-center hover:bg-white/10 transition"
                title="View Details"
                [routerLink]="['/console/dashboard', projectId(), 'deployment', deployment.id]"
              >
                <i class="pi pi-eye"></i>
              </button>
              @if (deployment.logs) {
              <button
                class="bg-transparent text-gray-200 border border-white/10 rounded w-[30px] h-[30px] grid place-items-center hover:bg-white/10 transition"
                title="View Logs"
                [routerLink]="['/console/dashboard', projectId(), 'deployment', deployment.id, 'logs']"
              >
                <i class="pi pi-list"></i>
              </button>
              } @if (deployment.status === 'deployed' || deployment.status ===
              'failed') {
              <button class="bg-transparent text-gray-200 border border-white/10 rounded w-[30px] h-[30px] grid place-items-center hover:bg-white/10 transition" title="Redeploy">
                <i class="pi pi-refresh"></i>
              </button>
              } @if (['building', 'infrastructure-provisioning',
              'deploying'].includes(deployment.status)) {
              <button class="bg-transparent text-red-400 border border-red-500/30 rounded w-[30px] h-[30px] grid place-items-center hover:bg-red-500/10 transition" title="Cancel">
                <i class="pi pi-times"></i>
              </button>
              }
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
    </div>
  </div>
  }
</div>
