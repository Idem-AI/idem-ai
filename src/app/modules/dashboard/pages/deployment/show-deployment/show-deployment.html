<div class="deployment-container">
  <!-- Error message display -->
  <div class="error-alert" *ngIf="errorMessage()">
    <i class="pi pi-exclamation-triangle"></i>
    <span>{{ errorMessage() }}</span>
    <button class="close-button" (click)="errorMessage.set(null)">
      <i class="pi pi-times"></i>
    </button>
  </div>

  <!-- Header Section -->
  <div class="deployment-header">
    <div class="header-content">
      <h1 class="title">Create Deployment</h1>
      <p class="subtitle">Configure and deploy your application</p>
    </div>
    <div class="header-actions">
      <button class="secondary-button" (click)="navigateToDeploymentsList()">
        <i class="pi pi-list"></i> View All Deployments
      </button>
    </div>
  </div>

  <!-- Mode Selection Section -->
  <div class="deployment-mode" *ngIf="deploymentMode() === null">
    <h2 class="section-title">Select Deployment Type</h2>
    <div class="mode-cards">
      <div class="mode-card" (click)="setDeploymentMode('quick')">
        <div class="mode-card-inner">
          <div class="icon">
            <i class="pi pi-bolt"></i>
          </div>
          <h3>Quick Deploy</h3>
          <p>Deploy with optimized defaults for your project type</p>
          <div class="card-footer">
            <button class="inner-button">Select</button>
          </div>
        </div>
      </div>

      <div class="mode-card" (click)="setDeploymentMode('advanced')">
        <div class="mode-card-inner">
          <div class="icon">
            <i class="pi pi-cog"></i>
          </div>
          <h3>Advanced Setup</h3>
          <p>Full control over infrastructure and deployment options</p>
          <div class="card-footer">
            <button class="inner-button">Select</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Deployment Form -->
  <div class="deployment-form" *ngIf="deploymentMode() === 'quick'">
    <div class="form-header">
      <h2 class="section-title">Quick Deployment</h2>
      <button class="outer-button" (click)="resetForms()">
        <i class="pi pi-arrow-left"></i> Back
      </button>
    </div>

    <form [formGroup]="gitRepositoryForm" class="form-container">
      <div class="form-group">
        <label for="repoUrl">Git Repository URL</label>
        <input
          id="repoUrl"
          type="text"
          formControlName="repoUrl"
          placeholder="https://github.com/username/repository.git"
          (blur)="fetchGitBranches()"
        />
        <div
          class="form-error"
          *ngIf="gitRepositoryForm.get('repoUrl')?.invalid && gitRepositoryForm.get('repoUrl')?.touched"
        >
          Please enter a valid Git repository URL
        </div>
      </div>

      <div class="form-group">
        <label for="name">Deployment Name</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          placeholder="My Deployment"
        />
        <div
          class="form-error"
          *ngIf="gitRepositoryForm.get('name')?.invalid && gitRepositoryForm.get('name')?.touched"
        >
          Please enter a valid deployment name
        </div>
      </div>

      <div class="form-group">
        <label for="environment">Environment</label>
        <select id="environment" formControlName="environment">
          <option value="development">Development</option>
          <option value="staging">Staging</option>
          <option value="production">Production</option>
        </select>
      </div>

      <div class="form-group">
        <label for="branch">Branch to Deploy</label>
        <select id="branch" formControlName="branch">
          <option value="" disabled>Select a branch</option>
          <option *ngFor="let branch of gitBranches()" [value]="branch">
            {{ branch }}
          </option>
        </select>
        <div class="loading-indicator" *ngIf="loadingGitInfo()">
          <i class="pi pi-spin pi-spinner"></i> Loading branches...
        </div>
      </div>

      <div class="form-actions">
        <button
          class="inner-button"
          [disabled]="gitRepositoryForm.invalid || loadingDeployment()"
          (click)="createDeployment()"
        >
          <i class="pi pi-rocket"></i>
          <span *ngIf="!loadingDeployment()">Deploy</span>
          <span *ngIf="loadingDeployment()">Deploying...</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Advanced Deployment Form -->
  <div class="deployment-form" *ngIf="deploymentMode() === 'advanced'">
    <div class="form-header">
      <h2 class="section-title">Advanced Deployment</h2>
      <button class="outer-button" (click)="resetForms()">
        <i class="pi pi-arrow-left"></i> Back
      </button>
    </div>

    <!-- Multi-step form for advanced deployment -->
    <div class="multi-step-form">
      <!-- Step 1: Git Repository -->
      <div class="form-step">
        <h3 class="step-title">
          <span class="step-number">1</span> Git Repository Configuration
        </h3>

        <form [formGroup]="gitRepositoryForm" class="form-container">
          <div class="form-group">
            <label for="adv-name">Deployment Name</label>
            <input
              id="adv-name"
              type="text"
              formControlName="name"
              placeholder="My Deployment"
            />
            <div
              class="form-error"
              *ngIf="gitRepositoryForm.get('name')?.invalid && gitRepositoryForm.get('name')?.touched"
            >
              Please enter a valid deployment name
            </div>
          </div>

          <div class="form-group">
            <label for="adv-environment">Environment</label>
            <select id="adv-environment" formControlName="environment">
              <option value="development">Development</option>
              <option value="staging">Staging</option>
              <option value="production">Production</option>
            </select>
          </div>

          <div class="form-group">
            <label for="adv-repoUrl">Git Repository URL</label>
            <input
              id="adv-repoUrl"
              type="text"
              formControlName="repoUrl"
              placeholder="https://github.com/username/repository.git"
              (blur)="fetchGitBranches()"
            />
            <div
              class="form-error"
              *ngIf="gitRepositoryForm.get('repoUrl')?.invalid && gitRepositoryForm.get('repoUrl')?.touched"
            >
              Please enter a valid Git repository URL
            </div>
          </div>

          <div class="form-group">
            <label for="adv-branch">Branch to Deploy</label>
            <select id="adv-branch" formControlName="branch">
              <option value="" disabled>Select a branch</option>
              <option *ngFor="let branch of gitBranches()" [value]="branch">
                {{ branch }}
              </option>
            </select>
            <div class="loading-indicator" *ngIf="loadingGitInfo()">
              <i class="pi pi-spin pi-spinner"></i> Loading branches...
            </div>
          </div>
        </form>
      </div>

      <!-- Step 2: Cloud Provider -->
      <div class="form-step">
        <h3 class="step-title">
          <span class="step-number">2</span> Cloud Provider Configuration
        </h3>

        <form [formGroup]="cloudProviderForm" class="form-container">
          <div class="cloud-providers-grid">
            <div class="cloud-provider-option">
              <input
                type="radio"
                id="aws"
                formControlName="provider"
                value="aws"
              />
              <label for="aws">
                <div class="provider-logo">
                  <i class="pi pi-cloud"></i> AWS
                </div>
              </label>
            </div>

            <div class="cloud-provider-option">
              <input
                type="radio"
                id="gcp"
                formControlName="provider"
                value="gcp"
              />
              <label for="gcp">
                <div class="provider-logo">
                  <i class="pi pi-cloud"></i> Google Cloud
                </div>
              </label>
            </div>

            <div class="cloud-provider-option">
              <input
                type="radio"
                id="azure"
                formControlName="provider"
                value="azure"
              />
              <label for="azure">
                <div class="provider-logo">
                  <i class="pi pi-cloud"></i> Azure
                </div>
              </label>
            </div>

            <div class="cloud-provider-option">
              <input
                type="radio"
                id="digitalocean"
                formControlName="provider"
                value="digitalocean"
              />
              <label for="digitalocean">
                <div class="provider-logo">
                  <i class="pi pi-cloud"></i> DigitalOcean
                </div>
              </label>
            </div>
          </div>

          <div class="form-group" *ngIf="cloudProviderForm.get('provider')?.value">
            <label for="region">Region</label>
            <select id="region" formControlName="region">
              <option value="" disabled>Select a region</option>
              <option *ngFor="let region of availableRegions()" [value]="region.code">
                {{ region.name }} ({{ region.code }})
              </option>
            </select>
            <div class="loading-indicator" *ngIf="loadingRegions()">
              <i class="pi pi-spin pi-spinner"></i> Loading regions...
            </div>
          </div>
        </form>
      </div>

      <!-- Step 3: Environment Variables & Secrets -->
      <div class="form-step">
        <h3 class="step-title">
          <span class="step-number">3</span> Environment Variables & Secrets
        </h3>

        <form [formGroup]="environmentVariablesForm" class="form-container">
          <div class="secrets-header">
            <h4>Environment Variables</h4>
            <button
              type="button"
              class="add-button"
              (click)="addEnvironmentVariable()"
            >
              <i class="pi pi-plus"></i> Add Variable
            </button>
          </div>

          <div
            class="secrets-list"
            formArrayName="variables"
          >
            <div
              *ngFor="let envVar of environmentVariablesArray().controls; let i = index"
              [formGroupName]="i"
              class="secret-item"
            >
              <div class="secret-inputs">
                <div class="form-group">
                  <label [attr.for]="'envVarKey' + i">Key</label>
                  <input
                    [id]="'envVarKey' + i"
                    type="text"
                    formControlName="key"
                    placeholder="VARIABLE_NAME"
                  />
                </div>
                <div class="form-group">
                  <label [attr.for]="'envVarValue' + i">Value</label>
                  <input
                    [id]="'envVarValue' + i"
                    type="text"
                    formControlName="value"
                    placeholder="variable_value"
                  />
                </div>
                <div class="form-group checkbox-group">
                  <label [attr.for]="'envVarSecret' + i" class="checkbox-label">
                    <input
                      [id]="'envVarSecret' + i"
                      type="checkbox"
                      formControlName="isSecret"
                    />
                    <span>Secret</span>
                  </label>
                </div>
              </div>
              <button
                type="button"
                class="remove-button"
                (click)="removeEnvironmentVariable(i)"
              >
                <i class="pi pi-times"></i>
              </button>
            </div>

            <div class="empty-secrets" *ngIf="environmentVariablesArray().length === 0">
              <p>No environment variables added yet</p>
              <button
                type="button"
                class="add-button"
                (click)="addEnvironmentVariable()"
              >
                <i class="pi pi-plus"></i> Add First Variable
              </button>
            </div>
          </div>
        </form>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          class="inner-button"
          [disabled]="gitRepositoryForm.invalid || loadingDeployment()"
          (click)="createDeployment()"
        >
          <i class="pi pi-rocket"></i>
          <span *ngIf="!loadingDeployment()">Deploy</span>
          <span *ngIf="loadingDeployment()">Deploying...</span>
        </button>
      </div>
    </div>
  </div>
</div>
