<!-- Main Container -->
<section
  class="flex flex-col min-h-[78vh] items-center justify-center w-full px-4 sm:px-6 lg:px-8"
>
  <!-- Logo Preferences Step -->
  @if (shouldShowPreferences()) {
  <app-logo-preferences
    (preferencesSelected)="onPreferencesSelected($event)"
  ></app-logo-preferences>
  }

  <!-- Loading State -->
  @if (shouldShowLoader()) {
  <div class="text-center mb-8">
    <h1
      class="text-xl sm:text-2xl md:text-3xl lg:text-4xl xl:text-5xl font-bold text-gray-100 mb-4 max-w-4xl"
    >
      Generating Your Logos...
    </h1>
    <p class="text-gray-400 sm:text-lg text-sm max-w-2xl mx-auto">
      Creating personalized logos based on your brand preferences.
    </p>
  </div>

  <div class="w-full max-w-7xl mx-auto">
    <!-- Loading Carousel -->
    <app-carousel
      [items]="[1, 2, 3]"
      [selectedItem]="null"
      [trackByFn]="trackSkeleton"
      [gridCols]="3"
      [showDots]="true"
      [showArrows]="false"
      [infinite]="false"
    >
      <ng-template let-item>
        <div class="p-4 sm:p-6 border-2 border-gray-700/50 glass rounded-xl">
          <div
            class="w-full h-48 mb-4 bg-gray-800/50 rounded-xl flex items-center justify-center"
          >
            <div
              class="w-20 h-20 bg-gray-700/50 rounded-lg animate-pulse"
            ></div>
          </div>
          <div class="h-6 bg-gray-700/50 rounded-lg animate-pulse mb-2"></div>
          <div class="h-4 bg-gray-700/30 rounded-lg animate-pulse w-3/4"></div>
        </div>
      </ng-template>
    </app-carousel>
  </div>

  <div class="mt-12 text-center">
    <div
      class="bg-gray-900/30 backdrop-blur-sm border border-gray-700/30 rounded-xl p-6 max-w-2xl mx-auto"
    >
      <h3 class="text-lg font-semibold text-white mb-3">
        ðŸ’¡ While you wait...
      </h3>
      <p class="text-gray-300 text-sm leading-relaxed">
        Our AI is analyzing your color palette and typography to create logos
        that perfectly match your brand identity.
      </p>
    </div>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div
    class="flex flex-col items-center justify-center min-h-[60vh] w-full px-4 sm:px-6 lg:px-8"
  >
    <div class="text-center max-w-md mx-auto">
      <div class="mb-6">
        <div
          class="inline-flex items-center justify-center w-16 h-16 bg-red-500/20 rounded-full mb-4"
        >
          <svg
            class="w-8 h-8 text-red-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            ></path>
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-white mb-2">Generation Failed</h3>
        <p class="text-gray-400 mb-6">{{error()}}</p>
      </div>

      <div class="flex flex-col sm:flex-row gap-3 justify-center">
        <button
          (click)="retryGeneration()"
          class="flex items-center justify-center px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors duration-200"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            ></path>
          </svg>
          Retry
        </button>
      </div>
    </div>
  </div>
  }

  <!-- Logo Selection State -->
  @if (!error() && shouldShowLogos()) {
  <div class="w-full max-w-7xl mx-auto mt-[50px] sm:mt-0">
    <!-- Header -->
    <div class="text-center mb-4">
      <h1 class="text-2xl sm:text-4xl font-bold text-white mb-1">
        Choose Your Perfect Logo
      </h1>

      <p class="text-xs md:text-xl text-gray-300 mb-4">
        Select the logo that best represents your brand identity
      </p>

      <!-- Action Buttons -->
      <div class="flex justify-center gap-3 mt-4">
        @if (selectedLogoId()) {
        <button
          (click)="openEditorChat()"
          class="outer-button inline-flex items-center px-4 py-2 text-sm"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
            />
          </svg>
          Edit with AI Assistant
        </button>
        } @if (displayedLogos().length > 0 && !isGenerating()) {
        <button
          (click)="regenerateAllLogos()"
          class="outer-button inline-flex items-center px-4 py-2 text-sm"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            />
          </svg>
          Regenerate Logos
        </button>
        }
      </div>
    </div>

    <!-- Responsive Logo Display -->
    <app-carousel
      [items]="displayedLogos()"
      [selectedItem]="null"
      [trackByFn]="trackLogo"
      [gridCols]="3"
      [showDots]="true"
      [showArrows]="true"
      [infinite]="false"
      (currentItemChanged)="onCarouselItemChanged($event)"
    >
      <ng-template let-logo let-index="index" let-isSelected="isSelected">
        <div
          class="cursor-pointer transform transition-all duration-300 hover:scale-[1.02]"
          (click)="selectLogo(logo.id)"
          [attr.aria-pressed]="selectedLogoComputed() === logo.id"
        >
          <div
            class="relative bg-gray-900/40 backdrop-blur-sm border-2 border-transparent glass hover:border-gray-600 rounded-2xl p-6 transition-all duration-300 cursor-pointer group overflow-hidden hover:-translate-y-1"
            [style.boxShadow]="selectedLogoComputed() === logo.id ? '0 0 15px rgba(99, 102, 241, 0.5)' : 'none'"
            [class.border-primary]="selectedLogoComputed() === logo.id"
            [class.bg-gray-900]="selectedLogoComputed() === logo.id"
            [style.borderColor]="selectedLogoComputed() === logo.id ? 'rgb(99, 102, 241)' : ''"
          >
            <!-- Selection Indicator -->
            @if (selectedLogoComputed() === logo.id) {
            <div
              class="absolute top-3 right-3 z-50 w-10 h-10 bg-primary rounded-full flex items-center justify-center"
            >
              <svg
                class="w-5 h-5 text-white"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fill-rule="evenodd"
                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </div>
            }

            <!-- Background Gradient -->
            <div
              class="absolute inset-0 bg-gradient-to-br from-primary/10 to-secondary/10 opacity-0 group-hover:opacity-10 transition-opacity duration-300"
              [class.opacity-20]="selectedLogoComputed() === logo.id"
            ></div>

            <!-- Logo Container -->
            <div class="relative z-10">
              <div
                class="w-full bg-white rounded-xl flex items-center justify-center p-3 sm:p-4 md:p-6 shadow-lg mb-4 h-[140px] sm:h-[160px] md:h-[180px]"
              >
                <div
                  [innerHTML]="logo.svg | safeHtml"
                  class="w-full h-full flex items-center justify-center [&>svg]:max-w-full [&>svg]:max-h-full"
                ></div>
              </div>

              <!-- Logo Info -->
              <div class="text-center">
                <h3
                  class="text-lg font-bold text-white mb-2 group-hover:text-primary transition-colors duration-300"
                >
                  {{ logo.name }}
                </h3>
                <p
                  class="text-gray-400 text-sm mb-4 leading-relaxed line-clamp-2 h-12 overflow-hidden"
                >
                  {{ logo.concept }}
                </p>

                <!-- Color Palette -->
                <div class="flex items-center justify-center space-x-2 mb-3">
                  <span class="text-xs text-gray-500 mr-2">Colors:</span>
                  @for (color of logo.colors; track color) {
                  <div
                    class="w-4 h-4 rounded-full border-2 border-gray-600"
                    [style.background-color]="color"
                    [title]="color"
                  ></div>
                  }
                </div>

                <!-- Fonts -->
                <div class="flex flex-wrap justify-center gap-2">
                  @for (font of logo.fonts; track font) {
                  <span
                    class="text-xs bg-gray-700/50 text-gray-300 px-2 py-1 rounded-full"
                    >{{ font }}</span
                  >
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    </app-carousel>

    <!-- Logo Editor Chat -->
    @if (showEditorChat() && selectedLogoForEdit()) {
    <app-logo-editor-chat
      [projectId]="projectId()!"
      [initialLogo]="selectedLogoForEdit()!"
      (logoSelected)="onLogoSelectedFromChat($event)"
      (closed)="closeEditorChat()"
    />
    }

    <!-- Retry Button (if generation failed) -->
    @if (currentStep().includes('failed')) {
    <div class="text-center mt-12">
      <button
        (click)="retryGeneration()"
        class="inline-flex items-center px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors duration-300"
      >
        <svg
          class="w-5 h-5 mr-2"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
          ></path>
        </svg>
        Retry Generation
      </button>
    </div>
    }
  </div>
  }
</section>

<!-- Custom Styles -->
<style>
  @keyframes shimmer {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }

  .animate-shimmer {
    animation: shimmer 2s infinite;
  }
</style>
