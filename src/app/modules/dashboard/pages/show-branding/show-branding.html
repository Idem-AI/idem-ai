<div class="w-full min-h-screen md:p-6 rounded-2xl relative">
  @if(isLoading()) {
  <!-- Loading State -->
  <div class="max-w-7xl mx-auto">
    <div class="text-center py-20">
      <div class="mb-4">
        <app-loader />
      </div>
      <h3 class="text-lg font-medium text-white mb-2">Loading...</h3>
      <p class="text-gray-400">Checking for existing branding data</p>
    </div>
  </div>
  } @else if(showBrandingGuide() && existingBranding()) {
  <!-- Display PDF Branding Guide -->
  <app-branding-display 
    [branding]="existingBranding()!" 
    (generateRequested)="generateBranding()">
  </app-branding-display>
  <div class="fixed top-4 left-4 z-50">
    <button
      (click)="hideBrandingGuide()"
      class="glass-card px-4 py-2 text-white hover:bg-white/20 transition-all duration-300"
    >
      <i class="pi pi-arrow-left mr-2"></i>
      Back to Overview
    </button>
  </div>
  } @else if(hasError() && isRetryable()) {
  <!-- Error state with retry button -->
  <div class="max-w-4xl mx-auto text-center py-10">
    <div class="glass-card p-8">
      <div class="mb-6">
        <i class="pi pi-exclamation-triangle text-6xl text-red-400 mb-4"></i>
      </div>
      <h3 class="text-2xl font-bold text-white mb-4">Loading Error</h3>
      <p class="text-gray-300 mb-8">{{ errorMessage() }}</p>
      <div class="flex gap-4 justify-center">
        <button class="inner-button" (click)="retryLoadBranding()">
          <i class="pi pi-refresh mr-2"></i>
          Retry
        </button>
        <button
          class="glass-card px-6 py-3 text-white hover:bg-white/20 transition-all duration-300 rounded-lg"
          (click)="goToProjects()"
        >
          <i class="pi pi-arrow-left mr-2"></i>
          Back to Projects
        </button>
      </div>
    </div>
  </div>
  } @else if(hasProjectData() || hasBrandingData()) {
  <!-- Main Branding Overview -->
  <div class="max-w-7xl mx-auto space-y-8">
    <!-- Header Section -->
    <div class="glass-card p-6">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h1 class="text-3xl font-bold text-white mb-2">Brand Identity</h1>
          <p class="text-gray-300">
            @if(currentProject()) { {{ currentProject()!.name }} }
          </p>
        </div>
        @if(hasBrandingGuide()) {
        <button (click)="viewBrandingGuide()" class="inner-button">
          <i class="pi pi-file-pdf mr-2"></i>
          Get a Graphic Charter
        </button>
        }
      </div>
    </div>

    <!-- Branding Elements Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Logo Section -->
      <div class="glass-card p-6">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h3 class="text-xl font-semibold text-white">Logos</h3>
            <p class="text-gray-400 text-sm">Visual identity</p>
          </div>
          @if(existingBranding() && (existingBranding()!.logo!.svg ||
          existingBranding()!.generatedLogos!.length > 0)) {
          <button
            (click)="showDialog()"
            class="glass-card px-4 py-2 text-white hover:bg-white/20 transition-all duration-300 rounded-lg flex items-center gap-2"
            title="Download all logo variations as ZIP"
          >
            <i class="pi pi-download text-sm"></i>
            <span class="text-sm">ZIP</span>
          </button>
          }
        </div>

        @if(existingBranding() && (existingBranding()!.logo!.svg ||
        existingBranding()!.generatedLogos!.length > 0)) {
        <!-- Real Logo Data -->
        <div class="space-y-4">
          @if(existingBranding()!.logo!.svg) {
          <!-- Selected Logo -->
          <div class="glass-card p-4 text-center">
            <div
              class="w-24 h-24 mx-auto mb-3 bg-white rounded-lg flex items-center justify-center p-2"
            >
              <img [src]="existingBranding()!.logo.svg" class="w-full h-full" />
            </div>
            <p class="text-white font-medium">
              {{ existingBranding()!.logo.name || 'Main Logo' }}
            </p>
            <p class="text-gray-400 text-sm">Selected version</p>
          </div>
          }

          <!-- Logo Variations -->
          @if(existingBranding()!.logo!.variations) {
          <div class="grid grid-cols-2 gap-3">
            @if(existingBranding()!.logo!.variations!.withText!.lightBackground)
            {
            <div class="glass-card p-3 text-center">
              <div
                class="w-16 h-16 mx-auto mb-2 bg-white rounded flex items-center justify-center p-1"
              >
                <img
                  [src]="existingBranding()!.logo!.variations!.withText!.lightBackground"
                  class="w-full h-full"
                />
              </div>
              <p class="text-white text-xs">Light background</p>
            </div>
            } @if(existingBranding()!.logo.variations!.withText!.darkBackground)
            {
            <div class="glass-card p-3 text-center">
              <div
                class="w-16 h-16 mx-auto mb-2 bg-gray-800/50 rounded flex items-center justify-center p-1"
              >
                <img
                  [src]="existingBranding()!.logo.variations!.withText!.darkBackground"
                  class="w-full h-full"
                />
              </div>
              <p class="text-white text-xs">Dark background</p>
            </div>
            }
            @if(existingBranding()!.logo.variations!.iconOnly!.lightBackground!)
            {
            <div class="glass-card p-3 text-center">
              <div
                class="w-16 h-16 mx-auto mb-2 bg-white rounded flex items-center justify-center p-1"
              >
                <img
                  [src]="existingBranding()!.logo.variations!.iconOnly!.lightBackground"
                  class="w-full h-full"
                />
              </div>
              <p class="text-white text-xs">Icon only</p>
            </div>
            } @if(existingBranding()!.logo.variations!.withText?.monochrome) {
            <div class="glass-card p-3 text-center">
              <div
                class="w-16 h-16 mx-auto mb-2 bg-white/10 rounded flex items-center justify-center p-1"
              >
                <img
                  [src]="existingBranding()!.logo.variations!.withText!.monochrome"
                  class="w-full h-full"
                />
              </div>
              <p class="text-white text-xs">Monochrome</p>
            </div>
            }
          </div>
          }
        </div>
        } @else {
        <div class="text-center py-8">
          <i class="pi pi-image text-4xl text-gray-500 mb-3"></i>
          <p class="text-gray-400">No logos available</p>
        </div>
        }
      </div>

      <!-- Colors Section -->
      <div class="glass-card p-6">
        <div class="flex items-center mb-6">
          <div>
            <h3 class="text-xl font-semibold text-white">Colors</h3>
            <p class="text-gray-400 text-sm">Color palette</p>
          </div>
        </div>

        @if(existingBranding() && (existingBranding()!.colors!.colors ||
        existingBranding()!.generatedColors!.length > 0)) {
        <!-- Real Color Data -->
        <div class="space-y-4">
          @if(existingBranding()!.colors!.colors) {
          <!-- Selected Color Palette -->
          <div class="space-y-3">
            <p class="text-white font-medium mb-3">
              {{ existingBranding()!.colors.name || 'Selected Palette' }}
            </p>
            <div class="grid grid-cols-2 gap-3">
              @if(existingBranding()!.colors.colors.primary) {
              <div class="glass-card p-3">
                <div
                  class="w-full h-12 rounded mb-2"
                  [style.background-color]="existingBranding()!.colors.colors.primary"
                ></div>
                <p class="text-white text-sm font-medium">Primary</p>
                <p class="text-gray-400 text-xs">
                  {{ existingBranding()!.colors.colors.primary }}
                </p>
              </div>
              } @if(existingBranding()!.colors.colors.secondary) {
              <div class="glass-card p-3">
                <div
                  class="w-full h-12 rounded mb-2"
                  [style.background-color]="existingBranding()!.colors.colors.secondary"
                ></div>
                <p class="text-white text-sm font-medium">Secondary</p>
                <p class="text-gray-400 text-xs">
                  {{ existingBranding()!.colors.colors.secondary }}
                </p>
              </div>
              } @if(existingBranding()!.colors.colors.accent) {
              <div class="glass-card p-3">
                <div
                  class="w-full h-12 rounded mb-2"
                  [style.background-color]="existingBranding()!.colors.colors.accent"
                ></div>
                <p class="text-white text-sm font-medium">Accent</p>
                <p class="text-gray-400 text-xs">
                  {{ existingBranding()!.colors.colors.accent }}
                </p>
              </div>
              } @if(existingBranding()!.colors.colors.background) {
              <div class="glass-card p-3">
                <div
                  class="w-full h-12 rounded mb-2"
                  [style.background-color]="existingBranding()!.colors.colors.background"
                ></div>
                <p class="text-white text-sm font-medium">Background</p>
                <p class="text-gray-400 text-xs">
                  {{ existingBranding()!.colors.colors.background }}
                </p>
              </div>
              }
            </div>
          </div>
          }
        </div>
        } @else {
        <div class="text-center py-8">
          <i class="pi pi-palette text-4xl text-gray-500 mb-3"></i>
          <p class="text-gray-400">No color palette available</p>
        </div>
        }
      </div>

      <!-- Typography Section -->
      <div class="glass-card p-6">
        <div class="flex items-center mb-6">
          <div>
            <h3 class="text-xl font-semibold text-white">Typography</h3>
            <p class="text-gray-400 text-sm">Font families</p>
          </div>
        </div>

        @if(existingBranding() && (existingBranding()!.typography!.primaryFont
        || existingBranding()!.generatedTypography!.length > 0)) {
        <!-- Real Typography Data -->
        <div class="space-y-4">
          @if(existingBranding()!.typography!.primaryFont) {
          <!-- Selected Typography -->
          <div class="space-y-3">
            <p class="text-white font-medium mb-3">
              {{ existingBranding()!.typography.name || 'Selected Typography' }}
            </p>

            <!-- Primary Font -->
            <div class="glass-card p-4">
              <h4
                class="text-2xl font-bold text-white mb-2"
                [style.font-family]="existingBranding()!.typography.primaryFont"
              >
                {{ existingBranding()!.typography.primaryFont }}
              </h4>
              <p class="text-gray-400 text-sm mb-3">Primary font</p>
              <div class="space-y-1">
                <p
                  class="text-white text-lg font-bold"
                  [style.font-family]="existingBranding()!.typography.primaryFont"
                >
                  Aa Bb Cc
                </p>
                <p
                  class="text-gray-300 text-base font-medium"
                  [style.font-family]="existingBranding()!.typography.primaryFont"
                >
                  Aa Bb Cc
                </p>
                <p
                  class="text-gray-400 text-sm"
                  [style.font-family]="existingBranding()!.typography.primaryFont"
                >
                  Aa Bb Cc
                </p>
              </div>
            </div>

            <!-- Secondary Font -->
            @if(existingBranding()!.typography.secondaryFont) {
            <div class="glass-card p-4">
              <h4
                class="text-xl text-white mb-2"
                [style.font-family]="existingBranding()!.typography.secondaryFont"
              >
                {{ existingBranding()!.typography.secondaryFont }}
              </h4>
              <p class="text-gray-400 text-sm mb-3">Secondary font</p>
              <div class="space-y-1">
                <p
                  class="text-white text-base"
                  [style.font-family]="existingBranding()!.typography.secondaryFont"
                >
                  Aa Bb Cc
                </p>
                <p
                  class="text-gray-300 text-sm"
                  [style.font-family]="existingBranding()!.typography.secondaryFont"
                >
                  Aa Bb Cc
                </p>
              </div>
            </div>
            }
          </div>
          }
        </div>
        } @else {
        <div class="text-center py-8">
          <i class="pi pi-font text-4xl text-gray-500 mb-3"></i>
          <p class="text-gray-400">No typography available</p>
        </div>
        }
      </div>
    </div>
  </div>
  } @else {
  <!-- Empty State - No project ID -->
  <div class="max-w-4xl mx-auto text-center py-20">
    <div class="glass-card p-8">
      <div class="mb-6">
        <i class="pi pi-exclamation-triangle text-6xl text-gray-400 mb-4"></i>
      </div>
      <h3 class="text-2xl font-bold text-white mb-4">No Project Selected</h3>
      <p class="text-gray-300 mb-8">
        Please select a project to view its brand identity.
      </p>
      <button class="inner-button" (click)="goToProjects()">
        <i class="pi pi-folder mr-2"></i>
        Select Project
      </button>
    </div>
  </div>
  }

  <!-- Extension Selection Dialog -->
  <p-dialog
    header="Choose Format"
    [modal]="true"
    [(visible)]="visible"
    [style]="{ width: '25rem' }"
    styleClass="extension-dialog centered-modal"
  >
    <span class="p-text-secondary block mb-8"
      >Select the desired format to download all logo variations.</span
    >

    <!-- Extension Options -->
    <div class="space-y-3 mb-6">
      <!-- SVG Option -->
      <div
        class="glass-card p-4 cursor-pointer transition-all duration-300 hover:bg-white/10"
        [class.ring-2]="selectedExtension === 'svg'"
        [class.ring-blue-400]="selectedExtension === 'svg'"
        (click)="selectExtension('svg')"
      >
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div
              class="w-12 h-12 bg-zinc-200 rounded-lg flex items-center justify-center p-2"
            >
              <img
                src="https://uxwing.com/wp-content/themes/uxwing/download/file-and-folder-type/svg-icon.png"
                alt="SVG"
                class="w-full h-full"
              />
            </div>
            <div>
              <h4 class="text-white font-medium">SVG</h4>
              <p class="text-gray-400 text-sm">Vector format, scalable</p>
            </div>
          </div>
          @if(selectedExtension === 'svg') {
          <i class="pi pi-check-circle text-blue-400"></i>
          }
        </div>
      </div>

      <!-- PNG Option -->
      <div
        class="glass-card p-4 cursor-pointer transition-all duration-300 hover:bg-white/10"
        [class.ring-2]="selectedExtension === 'png'"
        [class.ring-green-400]="selectedExtension === 'png'"
        (click)="selectExtension('png')"
      >
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div
              class="w-12 h-12 bg-zinc-200 rounded-lg flex items-center justify-center p-2"
            >
              <img
                src="https://cdn-icons-png.flaticon.com/512/337/337948.png"
                alt="PNG"
                class="w-full h-full"
              />
            </div>
            <div>
              <h4 class="text-white font-medium">PNG</h4>
              <p class="text-gray-400 text-sm">Bitmap format, high quality</p>
            </div>
          </div>
          @if(selectedExtension === 'png') {
          <i class="pi pi-check-circle text-green-400"></i>
          }
        </div>
      </div>

      <!-- PSD Option -->
      <div
        class="glass-card p-4 cursor-pointer transition-all duration-300 hover:bg-white/10"
        [class.ring-2]="selectedExtension === 'psd'"
        [class.ring-purple-400]="selectedExtension === 'psd'"
        (click)="selectExtension('psd')"
      >
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div
              class="w-12 h-12 bg-zinc-200 rounded-lg flex items-center justify-center p-2"
            >
              <img
                src="https://cdn-icons-png.flaticon.com/512/9645/9645799.png"
                alt="PSD"
                class="w-full h-full"
              />
            </div>
            <div>
              <h4 class="text-white font-medium">PSD</h4>
              <p class="text-gray-400 text-sm">Photoshop, editable layers</p>
            </div>
          </div>
          @if(selectedExtension === 'psd') {
          <i class="pi pi-check-circle text-purple-400"></i>
          }
        </div>
      </div>
    </div>

    <div class="flex justify-end gap-2">
      <button
        class="outer-button"
        (click)="visible = false"
        [disabled]="isDownloading()"
      >
        Cancel
      </button>
      <button
        class="inner-button"
        (click)="downloadLogosZip()"
        [disabled]="isDownloading()"
      >
        {{ isDownloading() ? 'Downloading...' : 'Download' }}
      </button>
    </div>

    <!-- Loading overlay -->
    @if(isDownloading()) {
    <div
      class="absolute inset-0 bg-black/50 backdrop-blur-sm rounded-lg flex items-center justify-center"
    >
      <div class="text-center">
        <app-loader />
        <p class="text-white mt-4 font-medium">Preparing download...</p>
        <p class="text-gray-400 text-sm">This may take a few moments</p>
      </div>
    </div>
    }
  </p-dialog>
</div>
