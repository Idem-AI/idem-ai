<!-- Navbar -->
<nav
  class="fixed top-0 left-0 right-0 z-50 glass border-b border-gray-200 px-3 py-3 lg:px-6"
>
  <div class="flex items-center justify-between">
    <div class="flex items-center">
      <!-- Mobile menu button - visible only on mobile, placed before logo -->
      <button
        type="button"
        class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 mr-2"
        (click)="toggleMobileDrawer()"
      >
        <span class="sr-only">Open mobile menu</span>
        <svg
          class="w-6 h-6"
          aria-hidden="true"
          fill="currentColor"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            clip-rule="evenodd"
            fill-rule="evenodd"
            d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z"
          ></path>
        </svg>
      </button>

      <!-- Desktop sidebar toggle - visible only on desktop -->
      <button
        type="button"
        class="hidden md:inline-flex items-center p-2 text-sm text-gray-500 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 mr-2"
        (click)="toggleSidebar()"
      >
        <span class="sr-only">Toggle sidebar</span>
        <svg
          class="w-6 h-6"
          aria-hidden="true"
          fill="currentColor"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            clip-rule="evenodd"
            fill-rule="evenodd"
            d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z"
          ></path>
        </svg>
      </button>

      <div class="flex-shrink-0 flex items-center">
        <a
          routerLink="/"
          class="text-2xl font-bold hover:text-blue-700 transition duration-300 flex items-center gap-1"
        >
          <img
            src="/assets/icons/logo_white.png"
            alt=""
            class="w-[120px] h-auto font-bold"
          />
          <app-beta-badge></app-beta-badge>
        </a>
      </div>
      <!-- Desktop Project Selector in Navbar -->
      <div class="hidden md:block ml-4 w-64">
        <p-select
          [options]="dropDownProjects()"
          [ngModel]="selectedProject()"
          optionLabel="name"
          placeholder="Select a project"
          (onChange)="onProjectChange($event)"
          styleClass="w-full"
        ></p-select>
      </div>
    </div>

    <!-- User profile section - always visible on right -->
    <div class="flex items-center relative z-50">
      @if (user()) {
      <!-- Badge Beta et Quotas - hidden on mobile -->
      <div class="hidden md:flex items-center space-x-4 mr-4">
        <app-quota-display
          [quotaInfo]="quotaInfo() ?? null"
          [quotaDisplay]="quotaDisplay() ?? null"
          [isBeta]="isBeta()"
          [betaRestrictions]="betaRestrictions() ?? null"
          [isLoading]="isQuotaLoading()"
        ></app-quota-display>
      </div>
      <div class="relative">
        <!-- Avatar -->
        <button (click)="toggleDropdown()" class="flex items-center">
          <img
            [src]="user()!.photoURL"
            alt="Avatar"
            class="w-8 h-8 md:w-10 md:h-10 rounded-full cursor-pointer"
          />
        </button>

        <!-- Dropdown Menu -->
        @if (isDropdownOpen()) {
        <div
          class="absolute right-0 mt-2 w-48 bg-gradient-to-r from-gray-900 to-gray-800 border border-gray-200 rounded-lg shadow-lg flex flex-col z-50 p-2"
        >
          <a
            routerLink="/profile"
            (click)="navigateTo('/profile')"
            class="dropdown-item p-3 hover:bg-primary rounded-2xl cursor-pointer text-white"
            >Profil</a
          >
          <a
            routerLink="/console/projects"
            (click)="navigateTo('/console/projects')"
            class="dropdown-item p-3 hover:bg-primary rounded-2xl cursor-pointer text-white"
            >Projets</a
          >
          <a
            routerLink="settings"
            (click)="navigateTo('settings')"
            class="dropdown-item p-3 hover:bg-primary rounded-2xl cursor-pointer text-white"
            >Settings</a
          >
          <a
            (click)="logout()"
            class="dropdown-item border-t p-3 hover:bg-primary cursor-pointer text-white"
            >Logout</a
          >
        </div>
        }
      </div>
      } @else {
      <div>
        <div
          class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-gray-300 animate-pulse"
        ></div>
      </div>
      }
    </div>
  </div>
</nav>
<!-- Desktop Sidebar - hidden on mobile -->
<div
  [@sidebarExpand]="sidebarState()"
  class="hidden md:block p-4 pt-[130px] h-screen glass border-r-1 border-gray-800 shadow-lg shadow-primary/10 overflow-y-auto overflow-x-hidden transition-all duration-300"
  [ngClass]="{'sidebar-collapsed': isSidebarCollapsed()}"
>
  <button
    (click)="toggleSidebar()"
    class="sidebar-toggle-btn absolute -right-3 top-24 bg-gradient-to-r from-gray-800/90 to-gray-700/90 hover:from-primary hover:to-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center shadow-lg z-50 transition-all duration-300 border border-gray-700/50"
  >
    <i
      class="pi"
      [ngClass]="isSidebarCollapsed() ? 'pi-chevron-right' : 'pi-chevron-left'"
    ></i>
  </button>
  <p-panelMenu [model]="items()" [style]="{ width: '100%' }"></p-panelMenu>
</div>

<!-- Mobile Drawer -->
<p-drawer
  [(visible)]="isMobileDrawerOpen"
  position="left"
  [modal]="true"
  [dismissible]="true"
  [closeOnEscape]="true"
  styleClass="md:hidden glass"
>
  <ng-template pTemplate="header">
    <div class="flex-shrink-0 flex items-center">
      <a
        routerLink="/"
        class="text-2xl font-bold hover:text-blue-700 transition duration-300 flex items-center gap-1"
      >
        <img
          src="/assets/icons/logo_white.png"
          alt=""
          class="w-[120px] h-auto font-bold"
        />
        <app-beta-badge></app-beta-badge>
      </a>
    </div>
  </ng-template>

  <div class="p-4">
    <!-- Mobile Quota Display -->
    @if (user()) {
    <div class="mb-4 pb-4 border-b border-gray-200">
      <app-quota-display
        [quotaInfo]="quotaInfo() ?? null"
        [quotaDisplay]="quotaDisplay() ?? null"
        [isBeta]="isBeta()"
        [betaRestrictions]="betaRestrictions() ?? null"
        [isLoading]="isQuotaLoading()"
      ></app-quota-display>
    </div>
    }

    <!-- Mobile Project Selector -->
    <div class="mb-4">
      <p-select
        [options]="dropDownProjects()"
        [ngModel]="selectedProject()"
        optionLabel="name"
        placeholder="Select a project"
        (onChange)="onProjectChange($event)"
        class="w-full"
      ></p-select>
    </div>

    <!-- Mobile Menu -->
    <p-panelMenu [model]="items()" [style]="{ width: '100%' }"></p-panelMenu>
  </div>
</p-drawer>
